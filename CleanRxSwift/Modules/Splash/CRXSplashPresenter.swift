//
//  CRXSplashPresenter.swift
//  CleanRxSwift
//
//  Created by Pedro Brito on 22/06/16.
//  Copyright (c) 2016 pedroml.brito. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so you can apply
//  clean architecture to your iOS and Mac projects, see http://clean-swift.com
//

import UIKit
import RxSwift
import QuickShotUtils;

protocol CRXSplashPresenterInput
{
  func bindView(view: CRXSplashViewController)
}

protocol CRXSplashPresenterOutput: class
{
  func finishSplashPage(viewModel: CRXSplashViewModel)
}

class CRXSplashPresenter: CRXSplashPresenterInput
{
  var _view: CRXSplashViewController!
 
  weak var _interactor: CRXSplashInteractor!;
  
  var disposeBag = DisposeBag()
  var subscription: Disposable!
  
  init(interactor: CRXSplashInteractor){
    self._interactor = interactor
    subscription = self._interactor.updateUserIsDone().observeOn(MainScheduler.instance).subscribeNext({ (result) in
      self.processOnBoardingState(result);
    })
    disposeBag.addDisposable(subscription);
  }

  
  // MARK: Presentation logic
  func presentSomething(response: CRXSplashResponse)
  {
    // NOTE: Format the response from the Interactor and pass the result back to the View Controller
    _view.finishSplashPage(CRXSplashViewModel(destination: response.destination, transitionType: response.transitionType));
  }

  
  func bindView(view: CRXSplashViewController){
    self._view = view;
  }

  func processOnBoardingState(isDone: Bool){
    var response = CRXSplashResponse();
    response.destination = isDone == true ? CRXSplashDestination.InApp : CRXSplashDestination.OnBoarding;
    response.transitionType = ViewControllerPresentationType.ReplaceAtRoot;
    
    self.presentSomething(response);
  }
}
